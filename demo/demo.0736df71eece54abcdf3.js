!function(){"use strict";var e,t={868:function(e,t,i){var n=i(755),s=i.n(n);i(419);class o{constructor(e){this.handleContentClick=e=>{const t=e.target;void 0===t||t.classList.contains("js-plugin-slider")||this.handleFormChange()},this.dom={root:e,indicator:null,form:null,content:null,thumb:null},this.numericVariables={min:0,max:10,step:1,from:1,to:null},this.booleanVariables={range:!1,marks:!1,tip:!1,progress:!1,vertical:!1},this.formValues=new Map,this.handleItemChange=this.handleItemChange.bind(this),this.handleContentPointerDown=this.handleContentPointerDown.bind(this),this.handleContentClick=this.handleContentClick.bind(this),this.handleThumbKeyPress=this.handleThumbKeyPress.bind(this),this.handleThumbTouchMove=this.handleThumbTouchMove.bind(this),this.handleFormChange=this.handleFormChange.bind(this),this.init()}init(){this.findElements(),this.createSlider(this.getSliderOptions()),this.addListeners()}static getFormValues(e){const t=new Map;return Array.from(e.querySelectorAll(".js-slider__input[data-role]")).forEach((e=>{const i=e.getAttribute("data-role");null!==i&&e instanceof HTMLInputElement&&t.set(i,e.value)})),t}addListeners(){var e,t;if(void 0===this.dom.form||null===this.dom.form)return;Array.from(this.dom.form.querySelectorAll(".js-slider__input")).forEach((e=>{if(e instanceof HTMLElement){const{role:t}=e.dataset;t&&e.addEventListener("change",(e=>{const t=e;this.handleItemChange(t)}))}})),null===(e=this.dom.content)||void 0===e||e.addEventListener("pointerdown",this.handleContentPointerDown),null===(t=this.dom.content)||void 0===t||t.addEventListener("click",this.handleContentClick),this.dom.thumb&&(this.dom.thumb.addEventListener("keydown",(e=>this.handleThumbKeyPress(e))),this.dom.thumb.addEventListener("touchmove",this.handleThumbTouchMove,{passive:!0}))}toggleIndicator(){this.dom.indicator&&(this.dom.indicator.classList.toggle("main__slider-indicator_active"),setTimeout((()=>{this.dom.indicator&&this.dom.indicator.classList.toggle("main__slider-indicator_active")}),100))}handleItemChange(e){var t;const{target:i}=e;if(i instanceof HTMLInputElement){const{role:e}=i.dataset,n=null===(t=this.mapElements)||void 0===t?void 0:t.get(`${e}`);if(void 0===n||void 0===this.slider)return;const s=this.slider.getValue(n);let o;"boolean"==typeof s?o=i.checked:"number"==typeof s&&(o=Number(i.value)),void 0!==o&&(this.slider.setValue(`${n}`,o),"valueFrom"!==n&&"valueTo"!==n&&null!==this.dom.content&&void 0!==this.dom.content&&(this.dom.content.innerHTML="",this.createSlider(this.slider.getState())),this.handleFormChange())}}hasFormChanged(e){const t=o.getFormValues(e);if(t.size!==this.formValues.size)return this.formValues=t,!0;for(const[e,i]of this.formValues.entries())if(t.get(e)!==i)return this.formValues=t,!0;return!1}handleFormChange(){this.updateForm(),this.hasFormChanged(this.dom.form)&&this.toggleIndicator(),this.findElements()}createSlider(e){void 0!==this.dom.content&&null!==this.dom.content&&(this.slider=s()(this.dom.content).sliderPlugin(e),this.handleFormChange())}findElements(){var e,t,i,n;if(this.dom.indicator=this.dom.root.querySelector(".js-main__slider-indicator"),this.dom.form=this.dom.root.querySelector(".js-slider__form"),!this.dom.form)return;const s=e=>{var t;return null===(t=this.dom.form)||void 0===t?void 0:t.querySelector(`.js-slider__input[data-role="${e}"]`)};this.mapElements=new Map,this.numericVariables.min=Number(null===(e=s("min"))||void 0===e?void 0:e.value),this.mapElements.set("min","min"),this.numericVariables.max=Number(null===(t=s("max"))||void 0===t?void 0:t.value),this.mapElements.set("max","max"),this.numericVariables.step=Number(null===(i=s("step"))||void 0===i?void 0:i.value),this.mapElements.set("step","step");const r=s("from");this.numericVariables.from=Number(r.value),r.step=`${this.numericVariables.step}`,this.mapElements.set("from","valueFrom");const a=s("to");this.numericVariables.to=Number(a.value),a.step=`${this.numericVariables.step}`,this.mapElements.set("to","valueTo");const l=s("range");this.booleanVariables.range=l.checked,a.disabled=!this.booleanVariables.range,this.mapElements.set("range","isRange");const h=s("marks");this.booleanVariables.marks=h.checked,this.mapElements.set("marks","scaleMarks");const d=s("tip");this.booleanVariables.tip=d.checked,this.mapElements.set("tip","isTip");const m=s("progress");this.booleanVariables.progress=m.checked,this.mapElements.set("progress","isProgress");const u=s("vertical");this.booleanVariables.vertical=u.checked,this.mapElements.set("vertical","isVertical"),this.dom.content=this.dom.root.querySelector(".js-slider__content"),this.dom.thumb=(null===(n=this.dom.content)||void 0===n?void 0:n.querySelector(".js-plugin-slider__thumb"))||null,void 0!==this.dom.form&&(this.formValues=o.getFormValues(this.dom.form))}updateForm(){void 0!==this.mapElements&&void 0!==this.dom.form&&void 0!==this.slider&&this.mapElements.forEach(((e,t)=>{var i,n;const s=null===(i=this.dom.form)||void 0===i?void 0:i.querySelector(`.js-slider__input[data-role="${t}"]`);if(null===s)return;const o=null===(n=this.slider)||void 0===n?void 0:n.getValue(e);"number"==typeof o?s.value=`${o}`:"boolean"==typeof o&&(s.checked=o)}))}handleContentPointerDown(){var e,t;const i=()=>{this.handleFormChange()},n=()=>{var e,t;null===(e=this.dom.content)||void 0===e||e.removeEventListener("pointermove",i),null===(t=this.dom.content)||void 0===t||t.removeEventListener("pointerup",n)};null===(e=this.dom.content)||void 0===e||e.addEventListener("pointermove",i),null===(t=this.dom.content)||void 0===t||t.addEventListener("pointerup",n)}handleThumbKeyPress(e){const{key:t}=e;["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(t)&&this.handleFormChange()}handleThumbTouchMove(){const e=e=>{e.stopImmediatePropagation(),this.handleFormChange()},t=()=>{document.removeEventListener("touchmove",e),document.removeEventListener("touchend",t)};document.addEventListener("touchmove",e),document.addEventListener("touchend",t)}getSliderOptions(){return{min:this.numericVariables.min,max:this.numericVariables.max,valueFrom:this.numericVariables.from||0,valueTo:this.numericVariables.to||0,step:this.numericVariables.step||1,scaleMarks:this.booleanVariables.marks,isTip:this.booleanVariables.tip,isProgress:this.booleanVariables.progress,isRange:this.booleanVariables.range,isVertical:this.booleanVariables.vertical}}}document.querySelectorAll(".js-main__slider").forEach((e=>new o(e)))}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=function(t,i,s,o){if(!i){var r=1/0;for(d=0;d<e.length;d++){i=e[d][0],s=e[d][1],o=e[d][2];for(var a=!0,l=0;l<i.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[l])}))?i.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(d--,1);var h=s();void 0!==h&&(t=h)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,s,o]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={577:0,309:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,o,r=i[0],a=i[1],l=i[2],h=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(l)var d=l(n)}for(t&&t(i);h<r.length;h++)o=r[h],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},i=self.webpackChunkmeta_slider=self.webpackChunkmeta_slider||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var s=n.O(void 0,[755,419],(function(){return n(868)}));s=n.O(s)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBVytCLEVBQUssR0FDaEJDLEVBQWNELEVBQUssR0FDbkJFLEVBQVVGLEVBQUssR0FHSTFCLEVBQUksRUFDM0IsR0FBR0wsRUFBU2tDLE1BQUssU0FBU0MsR0FBTSxPQUErQixJQUF4QlIsRUFBZ0JRLEVBQVcsSUFBSSxDQUNyRSxJQUFJNUMsS0FBWXlDLEVBQ1oxQyxFQUFvQjhCLEVBQUVZLEVBQWF6QyxLQUNyQ0QsRUFBb0JPLEVBQUVOLEdBQVl5QyxFQUFZekMsSUFHaEQsR0FBRzBDLEVBQVMsSUFBSWxDLEVBQVNrQyxFQUFRM0MsRUFDbEMsQ0FFQSxJQURHd0MsR0FBNEJBLEVBQTJCQyxHQUNyRDFCLEVBQUlMLEVBQVNNLE9BQVFELElBQ3pCdUIsRUFBVTVCLEVBQVNLLEdBQ2hCZixFQUFvQjhCLEVBQUVPLEVBQWlCQyxJQUFZRCxFQUFnQkMsSUFDckVELEVBQWdCQyxHQUFTLEtBRTFCRCxFQUFnQkMsR0FBVyxFQUU1QixPQUFPdEMsRUFBb0JRLEVBQUVDLEVBQzlCLEVBRUlxQyxFQUFxQkMsS0FBOEIsd0JBQUlBLEtBQThCLHlCQUFLLEdBQzlGRCxFQUFtQnJHLFFBQVE4RixFQUFxQjFHLEtBQUssS0FBTSxJQUMzRGlILEVBQW1CRSxLQUFPVCxFQUFxQjFHLEtBQUssS0FBTWlILEVBQW1CRSxLQUFLbkgsS0FBS2lILEcsSUNoRHZGLElBQUlHLEVBQXNCakQsRUFBb0JRLE9BQUVwRyxFQUFXLENBQUMsSUFBSSxNQUFNLFdBQWEsT0FBTzRGLEVBQW9CLElBQU0sSUFDcEhpRCxFQUFzQmpELEVBQW9CUSxFQUFFeUMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vbWV0YS1zbGlkZXIvLi9kZW1vLXBhZ2UvZGVtby1wYWdlLnRzIiwid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9tZXRhLXNsaWRlci93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL21ldGEtc2xpZGVyL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IGZ1bmN0aW9uKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgY2h1bmtJZHMgPSBkZWZlcnJlZFtpXVswXTtcblx0XHR2YXIgZm4gPSBkZWZlcnJlZFtpXVsxXTtcblx0XHR2YXIgcHJpb3JpdHkgPSBkZWZlcnJlZFtpXVsyXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoZnVuY3Rpb24oa2V5KSB7IHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSk7IH0pKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0dmFyIHIgPSBmbigpO1xuXHRcdFx0aWYgKHIgIT09IHVuZGVmaW5lZCkgcmVzdWx0ID0gcjtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuaW1wb3J0IHsgTW9kZWxJbnB1dFN0YXRlLCBNb2RlbFZhbHVlIH0gZnJvbSAnQHNyYy9jb21wb25lbnRzL0ludGVyZmFjZXMnO1xyXG5pbXBvcnQgJy4uL3NyYy9zbGlkZXInO1xyXG5pbXBvcnQgJy4vc3R5bGVzLnNjc3MnO1xyXG5cclxuaW50ZXJmYWNlIElEb21FbGVtZW50cyB7XHJcbiAgcm9vdDogRWxlbWVudDtcclxuICBpbmRpY2F0b3I6IEVsZW1lbnQgfCBudWxsO1xyXG4gIGZvcm0/OiBFbGVtZW50IHwgbnVsbDtcclxuICBjb250ZW50PzogRWxlbWVudCB8IG51bGw7XHJcbiAgdGh1bWI/OiBFbGVtZW50IHwgbnVsbDtcclxufVxyXG5cclxuaW50ZXJmYWNlIElCb29sZWFuVmFyaWFibGVzIHtcclxuICByYW5nZTogYm9vbGVhbjtcclxuICBtYXJrczogYm9vbGVhbjtcclxuICB0aXA6IGJvb2xlYW47XHJcbiAgcHJvZ3Jlc3M6IGJvb2xlYW47XHJcbiAgdmVydGljYWw6IGJvb2xlYW47XHJcbn1cclxuXHJcbmludGVyZmFjZSBJTnVtZXJpY1ZhcmlhYmxlcyB7XHJcbiAgbWluOiBudW1iZXI7XHJcbiAgbWF4OiBudW1iZXI7XHJcbiAgc3RlcDogbnVtYmVyO1xyXG4gIGZyb206IG51bWJlciB8IG51bGw7XHJcbiAgdG8/OiBudW1iZXIgfCBudWxsO1xyXG59XHJcblxyXG5jbGFzcyBEZW1vU2xpZGVyIHtcclxuXHJcbiAgcHJpdmF0ZSBtYXBFbGVtZW50czogTWFwPHN0cmluZywgTW9kZWxWYWx1ZT4gfCB1bmRlZmluZWQ7XHJcbiAgcHJpdmF0ZSBzbGlkZXI6IGltcG9ydCgnLi4vc3JjL2NvbXBvbmVudHMvUHJlc2VudGVyL1ByZXNlbnRlcicpLmRlZmF1bHQgfCB1bmRlZmluZWQ7XHJcbiAgcHJpdmF0ZSBmb3JtVmFsdWVzOiBNYXA8c3RyaW5nLCBzdHJpbmc+O1xyXG4gIHByaXZhdGUgZG9tOiBJRG9tRWxlbWVudHM7XHJcbiAgcHJpdmF0ZSBib29sZWFuVmFyaWFibGVzOiBJQm9vbGVhblZhcmlhYmxlcztcclxuICBwcml2YXRlIG51bWVyaWNWYXJpYWJsZXM6IElOdW1lcmljVmFyaWFibGVzO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihyb290OiBFbGVtZW50KSB7XHJcbiAgICB0aGlzLmRvbSA9IHtcclxuICAgICAgcm9vdCxcclxuICAgICAgaW5kaWNhdG9yOiBudWxsLFxyXG4gICAgICBmb3JtOiBudWxsLFxyXG4gICAgICBjb250ZW50OiBudWxsLFxyXG4gICAgICB0aHVtYjogbnVsbCxcclxuICAgIH07XHJcbiAgXHJcbiAgICB0aGlzLm51bWVyaWNWYXJpYWJsZXMgPSB7XHJcbiAgICAgIG1pbjogMCxcclxuICAgICAgbWF4OiAxMCxcclxuICAgICAgc3RlcDogMSxcclxuICAgICAgZnJvbTogMSxcclxuICAgICAgdG86IG51bGwsXHJcbiAgICB9O1xyXG4gIFxyXG4gICAgdGhpcy5ib29sZWFuVmFyaWFibGVzID0ge1xyXG4gICAgICByYW5nZTogZmFsc2UsXHJcbiAgICAgIG1hcmtzOiBmYWxzZSxcclxuICAgICAgdGlwOiBmYWxzZSxcclxuICAgICAgcHJvZ3Jlc3M6IGZhbHNlLFxyXG4gICAgICB2ZXJ0aWNhbDogZmFsc2UsXHJcbiAgICB9O1xyXG4gIFxyXG4gICAgdGhpcy5mb3JtVmFsdWVzID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcclxuXHJcblxyXG4gICAgdGhpcy5oYW5kbGVJdGVtQ2hhbmdlID0gdGhpcy5oYW5kbGVJdGVtQ2hhbmdlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmhhbmRsZUNvbnRlbnRQb2ludGVyRG93biA9IHRoaXMuaGFuZGxlQ29udGVudFBvaW50ZXJEb3duLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmhhbmRsZUNvbnRlbnRDbGljayA9IHRoaXMuaGFuZGxlQ29udGVudENsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmhhbmRsZVRodW1iS2V5UHJlc3MgPSB0aGlzLmhhbmRsZVRodW1iS2V5UHJlc3MuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuaGFuZGxlVGh1bWJUb3VjaE1vdmUgPSB0aGlzLmhhbmRsZVRodW1iVG91Y2hNb3ZlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmhhbmRsZUZvcm1DaGFuZ2UgPSB0aGlzLmhhbmRsZUZvcm1DaGFuZ2UuYmluZCh0aGlzKTtcclxuICBcclxuICAgIHRoaXMuaW5pdCgpO1xyXG4gIH1cclxuICBcclxuICBwdWJsaWMgaW5pdCgpIHtcclxuICAgIHRoaXMuZmluZEVsZW1lbnRzKCk7XHJcbiAgICB0aGlzLmNyZWF0ZVNsaWRlcih0aGlzLmdldFNsaWRlck9wdGlvbnMoKSk7XHJcbiAgICB0aGlzLmFkZExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBnZXRGb3JtVmFsdWVzKGZvcm06IEhUTUxGb3JtRWxlbWVudCk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xyXG4gICAgY29uc3QgZm9ybVZhbHVlcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICBjb25zdCBmb3JtRWxlbWVudHMgPSBBcnJheS5mcm9tKGZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLmpzLXNsaWRlcl9faW5wdXRbZGF0YS1yb2xlXScpKTtcclxuICAgIGZvcm1FbGVtZW50cy5mb3JFYWNoKChlbGVtZW50OiBFbGVtZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvbGUnKTtcclxuICAgICAgaWYgKGtleSAhPT0gbnVsbCAmJiBlbGVtZW50IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGZvcm1WYWx1ZXMuc2V0KGtleSwgZWxlbWVudC52YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGZvcm1WYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFkZExpc3RlbmVycygpIHtcclxuICAgIGlmICh0aGlzLmRvbS5mb3JtID09PSB1bmRlZmluZWQgfHwgdGhpcy5kb20uZm9ybSA9PT0gbnVsbCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGVsZW1lbnRzID0gQXJyYXkuZnJvbSh0aGlzLmRvbS5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1zbGlkZXJfX2lucHV0JykpO1xyXG4gICAgZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudDogRWxlbWVudCkgPT4ge1xyXG4gICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgeyByb2xlIH0gPSBlbGVtZW50LmRhdGFzZXQ7XHJcbiAgICAgICAgaWYgKHJvbGUpIHtcclxuICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGU6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0RXZlbnQgPSBlIGFzIElucHV0RXZlbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlSXRlbUNoYW5nZShpbnB1dEV2ZW50KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5kb20uY29udGVudD8uYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCB0aGlzLmhhbmRsZUNvbnRlbnRQb2ludGVyRG93bik7XHJcbiAgICB0aGlzLmRvbS5jb250ZW50Py5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ29udGVudENsaWNrKTtcclxuICAgIGlmICh0aGlzLmRvbS50aHVtYikge1xyXG4gICAgICB0aGlzLmRvbS50aHVtYi5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGU6IEV2ZW50KSA9PiB0aGlzLmhhbmRsZVRodW1iS2V5UHJlc3MoZSBhcyBLZXlib2FyZEV2ZW50KSk7XHJcbiAgICAgIHRoaXMuZG9tLnRodW1iLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuaGFuZGxlVGh1bWJUb3VjaE1vdmUsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdG9nZ2xlSW5kaWNhdG9yKCkge1xyXG4gICAgaWYgKHRoaXMuZG9tLmluZGljYXRvcikge1xyXG4gICAgICB0aGlzLmRvbS5pbmRpY2F0b3IuY2xhc3NMaXN0LnRvZ2dsZSgnbWFpbl9fc2xpZGVyLWluZGljYXRvcl9hY3RpdmUnKTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZG9tLmluZGljYXRvcikge1xyXG4gICAgICAgICAgdGhpcy5kb20uaW5kaWNhdG9yLmNsYXNzTGlzdC50b2dnbGUoJ21haW5fX3NsaWRlci1pbmRpY2F0b3JfYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVJdGVtQ2hhbmdlKGU6IElucHV0RXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBlO1xyXG5cclxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7XHJcbiAgICAgIGNvbnN0IHsgcm9sZSB9ID0gdGFyZ2V0LmRhdGFzZXQ7XHJcbiAgICAgIGNvbnN0IHBhcmFtID0gdGhpcy5tYXBFbGVtZW50cz8uZ2V0KGAke3JvbGV9YCk7XHJcbiAgICAgIGlmIChwYXJhbSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuc2xpZGVyID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgY29uc3QgdmFsdWVQYXJhbSA9IHRoaXMuc2xpZGVyLmdldFZhbHVlKHBhcmFtKTtcclxuXHJcbiAgICAgIGxldCB2YWx1ZTogbnVtYmVyIHwgYm9vbGVhbiB8IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZVBhcmFtID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICB2YWx1ZSA9IHRhcmdldC5jaGVja2VkO1xyXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZVBhcmFtID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgIHZhbHVlID0gTnVtYmVyKHRhcmdldC52YWx1ZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5zbGlkZXIuc2V0VmFsdWUoYCR7cGFyYW19YCwgdmFsdWUpO1xyXG4gICAgICAgIGlmIChwYXJhbSAhPT0gJ3ZhbHVlRnJvbScgJiYgcGFyYW0gIT09ICd2YWx1ZVRvJykge1xyXG4gICAgICAgICAgaWYgKHRoaXMuZG9tLmNvbnRlbnQgIT09IG51bGwgJiYgdGhpcy5kb20uY29udGVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZG9tLmNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlU2xpZGVyKHRoaXMuc2xpZGVyLmdldFN0YXRlKCkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhbmRsZUZvcm1DaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYXNGb3JtQ2hhbmdlZChmb3JtOiBIVE1MRm9ybUVsZW1lbnQpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IG5ld0Zvcm1WYWx1ZXMgPSBEZW1vU2xpZGVyLmdldEZvcm1WYWx1ZXMoZm9ybSk7XHJcbiAgICBpZiAobmV3Rm9ybVZhbHVlcy5zaXplICE9PSB0aGlzLmZvcm1WYWx1ZXMuc2l6ZSkge1xyXG4gICAgICB0aGlzLmZvcm1WYWx1ZXMgPSBuZXdGb3JtVmFsdWVzO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuZm9ybVZhbHVlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgaWYgKG5ld0Zvcm1WYWx1ZXMuZ2V0KGtleSkgIT09IHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtVmFsdWVzID0gbmV3Rm9ybVZhbHVlcztcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVGb3JtQ2hhbmdlKCkge1xyXG4gICAgdGhpcy51cGRhdGVGb3JtKCk7XHJcbiAgICBpZiAodGhpcy5oYXNGb3JtQ2hhbmdlZCh0aGlzLmRvbS5mb3JtIGFzIEhUTUxGb3JtRWxlbWVudCkpIHtcclxuICAgICAgdGhpcy50b2dnbGVJbmRpY2F0b3IoKTtcclxuICAgIH1cclxuICAgIHRoaXMuZmluZEVsZW1lbnRzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVNsaWRlcihvcHRpb25zOiBNb2RlbElucHV0U3RhdGUpIHtcclxuICAgIGlmICh0aGlzLmRvbS5jb250ZW50ID09PSB1bmRlZmluZWQgfHwgdGhpcy5kb20uY29udGVudCA9PT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgdGhpcy5zbGlkZXIgPSAkKHRoaXMuZG9tLmNvbnRlbnQpLnNsaWRlclBsdWdpbihvcHRpb25zKTtcclxuICAgIHRoaXMuaGFuZGxlRm9ybUNoYW5nZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaW5kRWxlbWVudHMoKSB7XHJcbiAgICB0aGlzLmRvbS5pbmRpY2F0b3IgPSB0aGlzLmRvbS5yb290LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tYWluX19zbGlkZXItaW5kaWNhdG9yJyk7XHJcbiAgICB0aGlzLmRvbS5mb3JtID0gdGhpcy5kb20ucm9vdC5xdWVyeVNlbGVjdG9yKCcuanMtc2xpZGVyX19mb3JtJyk7XHJcbiAgICBpZiAoIXRoaXMuZG9tLmZvcm0pIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBzZWxlY3RvciA9IChyb2xlOiBzdHJpbmcpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuZG9tLmZvcm0/LnF1ZXJ5U2VsZWN0b3IoYC5qcy1zbGlkZXJfX2lucHV0W2RhdGEtcm9sZT1cIiR7cm9sZX1cIl1gKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tYXBFbGVtZW50cyA9IG5ldyBNYXA8c3RyaW5nLCBNb2RlbFZhbHVlPigpO1xyXG4gICAgdGhpcy5udW1lcmljVmFyaWFibGVzLm1pbiA9IE51bWJlcigoc2VsZWN0b3IoJ21pbicpIGFzIEhUTUxJbnB1dEVsZW1lbnQpPy52YWx1ZSk7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgnbWluJywgJ21pbicpO1xyXG5cclxuICAgIHRoaXMubnVtZXJpY1ZhcmlhYmxlcy5tYXggPSBOdW1iZXIoKHNlbGVjdG9yKCdtYXgnKSBhcyBIVE1MSW5wdXRFbGVtZW50KT8udmFsdWUpO1xyXG4gICAgdGhpcy5tYXBFbGVtZW50cy5zZXQoJ21heCcsICdtYXgnKTtcclxuXHJcbiAgICB0aGlzLm51bWVyaWNWYXJpYWJsZXMuc3RlcCA9IE51bWJlcigoc2VsZWN0b3IoJ3N0ZXAnKSBhcyBIVE1MSW5wdXRFbGVtZW50KT8udmFsdWUpO1xyXG4gICAgdGhpcy5tYXBFbGVtZW50cy5zZXQoJ3N0ZXAnLCAnc3RlcCcpO1xyXG5cclxuICAgIGNvbnN0IGZyb20gPSBzZWxlY3RvcignZnJvbScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICB0aGlzLm51bWVyaWNWYXJpYWJsZXMuZnJvbSA9IE51bWJlcihmcm9tLnZhbHVlKTtcclxuICAgIGZyb20uc3RlcCA9IGAke3RoaXMubnVtZXJpY1ZhcmlhYmxlcy5zdGVwfWA7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgnZnJvbScsICd2YWx1ZUZyb20nKTtcclxuXHJcbiAgICBjb25zdCB0byA9IHNlbGVjdG9yKCd0bycpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICB0aGlzLm51bWVyaWNWYXJpYWJsZXMudG8gPSBOdW1iZXIodG8udmFsdWUpO1xyXG4gICAgdG8uc3RlcCA9IGAke3RoaXMubnVtZXJpY1ZhcmlhYmxlcy5zdGVwfWA7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgndG8nLCAndmFsdWVUbycpO1xyXG5cclxuICAgIGNvbnN0IHJhbmdlID0gc2VsZWN0b3IoJ3JhbmdlJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuYm9vbGVhblZhcmlhYmxlcy5yYW5nZSA9IHJhbmdlLmNoZWNrZWQ7XHJcbiAgICB0by5kaXNhYmxlZCA9ICF0aGlzLmJvb2xlYW5WYXJpYWJsZXMucmFuZ2U7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgncmFuZ2UnLCAnaXNSYW5nZScpO1xyXG5cclxuICAgIGNvbnN0IG1hcmtzID0gc2VsZWN0b3IoJ21hcmtzJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuYm9vbGVhblZhcmlhYmxlcy5tYXJrcyA9IG1hcmtzLmNoZWNrZWQ7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgnbWFya3MnLCAnc2NhbGVNYXJrcycpO1xyXG5cclxuICAgIGNvbnN0IHRpcCA9IHNlbGVjdG9yKCd0aXAnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgdGhpcy5ib29sZWFuVmFyaWFibGVzLnRpcCA9IHRpcC5jaGVja2VkO1xyXG4gICAgdGhpcy5tYXBFbGVtZW50cy5zZXQoJ3RpcCcsICdpc1RpcCcpO1xyXG5cclxuICAgIGNvbnN0IHByb2dyZXNzID0gc2VsZWN0b3IoJ3Byb2dyZXNzJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuYm9vbGVhblZhcmlhYmxlcy5wcm9ncmVzcyA9IHByb2dyZXNzLmNoZWNrZWQ7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgncHJvZ3Jlc3MnLCAnaXNQcm9ncmVzcycpO1xyXG5cclxuICAgIGNvbnN0IHZlcnRpY2FsID0gc2VsZWN0b3IoJ3ZlcnRpY2FsJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuYm9vbGVhblZhcmlhYmxlcy52ZXJ0aWNhbCA9IHZlcnRpY2FsLmNoZWNrZWQ7XHJcbiAgICB0aGlzLm1hcEVsZW1lbnRzLnNldCgndmVydGljYWwnLCAnaXNWZXJ0aWNhbCcpO1xyXG5cclxuICAgIHRoaXMuZG9tLmNvbnRlbnQgPSB0aGlzLmRvbS5yb290LnF1ZXJ5U2VsZWN0b3IoJy5qcy1zbGlkZXJfX2NvbnRlbnQnKTtcclxuICAgIHRoaXMuZG9tLnRodW1iID0gdGhpcy5kb20uY29udGVudD8ucXVlcnlTZWxlY3RvcignLmpzLXBsdWdpbi1zbGlkZXJfX3RodW1iJykgfHwgbnVsbDtcclxuXHJcbiAgICBpZiAodGhpcy5kb20uZm9ybSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRoaXMuZm9ybVZhbHVlcyA9IERlbW9TbGlkZXIuZ2V0Rm9ybVZhbHVlcyh0aGlzLmRvbS5mb3JtIGFzIEhUTUxGb3JtRWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUZvcm0oKSB7XHJcbiAgICBpZiAodGhpcy5tYXBFbGVtZW50cyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuZG9tLmZvcm0gPT09IHVuZGVmaW5lZCB8fCB0aGlzLnNsaWRlciA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcblxyXG4gICAgdGhpcy5tYXBFbGVtZW50cy5mb3JFYWNoKCh2YWx1ZTogc3RyaW5nLCBrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5kb20uZm9ybT8ucXVlcnlTZWxlY3RvcihgLmpzLXNsaWRlcl9faW5wdXRbZGF0YS1yb2xlPVwiJHtrZXl9XCJdYCkgYXMgSFRNTElucHV0RWxlbWVudCB8IG51bGw7XHJcbiAgICAgIGlmIChlbGVtZW50ID09PSBudWxsKSByZXR1cm47XHJcblxyXG4gICAgICBjb25zdCBzbGlkZXJWYWx1ZSA9IHRoaXMuc2xpZGVyPy5nZXRWYWx1ZSh2YWx1ZSBhcyBNb2RlbFZhbHVlKTtcclxuICAgICAgaWYgKHR5cGVvZiBzbGlkZXJWYWx1ZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICBlbGVtZW50LnZhbHVlID0gYCR7c2xpZGVyVmFsdWV9YDtcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2xpZGVyVmFsdWUgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgIGVsZW1lbnQuY2hlY2tlZCA9IHNsaWRlclZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQ29udGVudENsaWNrOiBFdmVudExpc3RlbmVyID0gKGU6IEV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBFbGVtZW50O1xyXG4gICAgaWYgKHRhcmdldCAhPT0gdW5kZWZpbmVkICYmICF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1wbHVnaW4tc2xpZGVyJykpIHtcclxuICAgICAgdGhpcy5oYW5kbGVGb3JtQ2hhbmdlKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVDb250ZW50UG9pbnRlckRvd24oKSB7XHJcbiAgICBjb25zdCBoYW5kbGVQb2ludGVyTW92ZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy5oYW5kbGVGb3JtQ2hhbmdlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGhhbmRsZVBvaW50ZXJVcCA9ICgpID0+IHtcclxuICAgICAgdGhpcy5kb20uY29udGVudD8ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBoYW5kbGVQb2ludGVyTW92ZSk7XHJcbiAgICAgIHRoaXMuZG9tLmNvbnRlbnQ/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJ1cCcsIGhhbmRsZVBvaW50ZXJVcCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZG9tLmNvbnRlbnQ/LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgaGFuZGxlUG9pbnRlck1vdmUpO1xyXG4gICAgdGhpcy5kb20uY29udGVudD8uYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgaGFuZGxlUG9pbnRlclVwKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlVGh1bWJLZXlQcmVzcyhlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGtleSB9ID0gZTtcclxuICAgIGlmIChbJ0Fycm93TGVmdCcsICdBcnJvd1VwJywgJ0Fycm93UmlnaHQnLCAnQXJyb3dEb3duJ10uaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICB0aGlzLmhhbmRsZUZvcm1DaGFuZ2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlVGh1bWJUb3VjaE1vdmUoKSB7XHJcbiAgICBjb25zdCBoYW5kbGVUaHVtYlRvdWNoTW92ZVN0YXJ0ID0gKGU6IFRvdWNoRXZlbnQpID0+IHtcclxuICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgdGhpcy5oYW5kbGVGb3JtQ2hhbmdlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGhhbmRsZVRodW1iVG91Y2hNb3ZlU3RhcnRFbmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZVRodW1iVG91Y2hNb3ZlU3RhcnQpO1xyXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZVRodW1iVG91Y2hNb3ZlU3RhcnRFbmQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBoYW5kbGVUaHVtYlRvdWNoTW92ZVN0YXJ0KTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlVGh1bWJUb3VjaE1vdmVTdGFydEVuZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNsaWRlck9wdGlvbnMoKTogTW9kZWxJbnB1dFN0YXRlIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1pbjogdGhpcy5udW1lcmljVmFyaWFibGVzLm1pbixcclxuICAgICAgbWF4OiB0aGlzLm51bWVyaWNWYXJpYWJsZXMubWF4LFxyXG4gICAgICB2YWx1ZUZyb206IHRoaXMubnVtZXJpY1ZhcmlhYmxlcy5mcm9tIHx8IDAsXHJcbiAgICAgIHZhbHVlVG86IHRoaXMubnVtZXJpY1ZhcmlhYmxlcy50byB8fCAwLFxyXG4gICAgICBzdGVwOiB0aGlzLm51bWVyaWNWYXJpYWJsZXMuc3RlcCB8fCAxLFxyXG4gICAgICBzY2FsZU1hcmtzOiB0aGlzLmJvb2xlYW5WYXJpYWJsZXMubWFya3MsXHJcbiAgICAgIGlzVGlwOiB0aGlzLmJvb2xlYW5WYXJpYWJsZXMudGlwLFxyXG4gICAgICBpc1Byb2dyZXNzOiB0aGlzLmJvb2xlYW5WYXJpYWJsZXMucHJvZ3Jlc3MsXHJcbiAgICAgIGlzUmFuZ2U6IHRoaXMuYm9vbGVhblZhcmlhYmxlcy5yYW5nZSxcclxuICAgICAgaXNWZXJ0aWNhbDogdGhpcy5ib29sZWFuVmFyaWFibGVzLnZlcnRpY2FsLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1tYWluX19zbGlkZXInKS5mb3JFYWNoKChlKSA9PiBuZXcgRGVtb1NsaWRlcihlKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBEZW1vU2xpZGVyO1xyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbl9fd2VicGFja19yZXF1aXJlX18ubSA9IF9fd2VicGFja19tb2R1bGVzX187XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0ZnVuY3Rpb24oKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG5cdFx0ZnVuY3Rpb24oKSB7IHJldHVybiBtb2R1bGU7IH07XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7IH0iLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0NTc3OiAwLFxuXHQzMDk6IDBcbn07XG5cbi8vIG5vIGNodW5rIG9uIGRlbWFuZCBsb2FkaW5nXG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gZnVuY3Rpb24oY2h1bmtJZCkgeyByZXR1cm4gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwOyB9O1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IGZ1bmN0aW9uKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSB7XG5cdHZhciBjaHVua0lkcyA9IGRhdGFbMF07XG5cdHZhciBtb3JlTW9kdWxlcyA9IGRhdGFbMV07XG5cdHZhciBydW50aW1lID0gZGF0YVsyXTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKGZ1bmN0aW9uKGlkKSB7IHJldHVybiBpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwOyB9KSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmttZXRhX3NsaWRlclwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmttZXRhX3NsaWRlclwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzc1NSw0MTldLCBmdW5jdGlvbigpIHsgcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oODY4KTsgfSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJEZW1vU2xpZGVyIiwiY29uc3RydWN0b3IiLCJyb290IiwiaGFuZGxlQ29udGVudENsaWNrIiwiZSIsInRhcmdldCIsInVuZGVmaW5lZCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwidGhpcyIsImhhbmRsZUZvcm1DaGFuZ2UiLCJkb20iLCJpbmRpY2F0b3IiLCJmb3JtIiwiY29udGVudCIsInRodW1iIiwibnVtZXJpY1ZhcmlhYmxlcyIsIm1pbiIsIm1heCIsInN0ZXAiLCJmcm9tIiwidG8iLCJib29sZWFuVmFyaWFibGVzIiwicmFuZ2UiLCJtYXJrcyIsInRpcCIsInByb2dyZXNzIiwidmVydGljYWwiLCJmb3JtVmFsdWVzIiwiTWFwIiwiaGFuZGxlSXRlbUNoYW5nZSIsImJpbmQiLCJoYW5kbGVDb250ZW50UG9pbnRlckRvd24iLCJoYW5kbGVUaHVtYktleVByZXNzIiwiaGFuZGxlVGh1bWJUb3VjaE1vdmUiLCJpbml0IiwiZmluZEVsZW1lbnRzIiwiY3JlYXRlU2xpZGVyIiwiZ2V0U2xpZGVyT3B0aW9ucyIsImFkZExpc3RlbmVycyIsImdldEZvcm1WYWx1ZXMiLCJBcnJheSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbWVudCIsImtleSIsImdldEF0dHJpYnV0ZSIsIkhUTUxJbnB1dEVsZW1lbnQiLCJzZXQiLCJ2YWx1ZSIsIkhUTUxFbGVtZW50Iiwicm9sZSIsImRhdGFzZXQiLCJhZGRFdmVudExpc3RlbmVyIiwiaW5wdXRFdmVudCIsInBhc3NpdmUiLCJ0b2dnbGVJbmRpY2F0b3IiLCJ0b2dnbGUiLCJzZXRUaW1lb3V0IiwicGFyYW0iLCJtYXBFbGVtZW50cyIsImdldCIsInNsaWRlciIsInZhbHVlUGFyYW0iLCJnZXRWYWx1ZSIsImNoZWNrZWQiLCJOdW1iZXIiLCJzZXRWYWx1ZSIsImlubmVySFRNTCIsImdldFN0YXRlIiwiaGFzRm9ybUNoYW5nZWQiLCJuZXdGb3JtVmFsdWVzIiwic2l6ZSIsImVudHJpZXMiLCJ1cGRhdGVGb3JtIiwib3B0aW9ucyIsIiQiLCJzbGlkZXJQbHVnaW4iLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3IiLCJkaXNhYmxlZCIsInNsaWRlclZhbHVlIiwiaGFuZGxlUG9pbnRlck1vdmUiLCJoYW5kbGVQb2ludGVyVXAiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaW5jbHVkZXMiLCJoYW5kbGVUaHVtYlRvdWNoTW92ZVN0YXJ0Iiwic3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIiwiaGFuZGxlVGh1bWJUb3VjaE1vdmVTdGFydEVuZCIsImRvY3VtZW50IiwidmFsdWVGcm9tIiwidmFsdWVUbyIsInNjYWxlTWFya3MiLCJpc1RpcCIsImlzUHJvZ3Jlc3MiLCJpc1JhbmdlIiwiaXNWZXJ0aWNhbCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwicmVzdWx0IiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwibGVuZ3RoIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsInNwbGljZSIsInIiLCJuIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJhIiwiZGVmaW5pdGlvbiIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJpbnN0YWxsZWRDaHVua3MiLCJjaHVua0lkIiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsImRhdGEiLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiaWQiLCJjaHVua0xvYWRpbmdHbG9iYWwiLCJzZWxmIiwicHVzaCIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9